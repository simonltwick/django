{% extends 'bike/base.html' %}

{% block title %}
Rides 
{% endblock %}

{% block content %}
<h1>Rides</h1>

<form id="rides-form" method='POST' action="">
{% csrf_token %}
<table class="table-sm">
<tr><td colspan="8">Rides selection:
<button type="submit" class="btn btn-outline-primary"
  formaction="">Apply Filter</button>
<input type="submit" class="btn btn-outline-secondary" value="Download as CSV"
    formaction="{% url 'bike:rides' %}?action=download_as_csv">
</td></tr>

{% if form.non_field_errors %}
  <tr><td colspan="8">{{ form.non_field_errors}}</td></tr>
{% endif %}

<tr class="table-info">
{% for field in form %}
  <td>
  <div class="fieldWrapper">
    {{ field.errors }}
    {{ field.label_tag }}
    {{ field }}
	<br>{{ field.help_text }}
  </div><td>
{% endfor %}
</tr></table>
<br><p>Selected rides:

<span class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
        	<button type="submit" class="btn btn-link"
        	formaction="?page=1">&laquo; first</button>
            <button type="submit" class="btn btn-link"
            formaction="?page={{ page_obj.previous_page_number }}"
            >previous</button>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
        	<button type="submit" class="btn btn-link"
        	formaction="?page={{ page_obj.next_page_number }}"
        	>next</button>
        	<button type="submit" class="btn btn-link"
        	formaction="?page={{ page_obj.paginator.num_pages }}"
        	>last &raquo;</button>
        {% endif %}
    </span>
</span></p>

</form>


{% for ride in page_obj %}

{% if forloop.first %}
  <table class="table table-sm table-hover">
  <tr><th>date</th><th>bike</th><th>ride</th>
  <th>distance<br><small class="text-muted">{{ user.preferences.distance_units_label.lower }}</small></th>
  <th>ascent<br><small class="text-muted">{{ user.preferences.ascent_units_label.lower }}</small></th>
  </tr>
{% endif %}

<tr>
  <td>{{ ride.date|date:"D j M y" }}</td><td>{{ ride.bike }}</td>
  <td>
    {% if ride.is_adjustment %}
	  <a href="{% url 'bike:odometer_adjustment_ride' ride_id=ride.id %}">
    {% else %}
	  <a href="{% url 'bike:ride' ride.id %}">
    {% endif %}
    {{ ride.description|truncatechars:40 }}</a></td>
  <td>{{ ride.distance|floatformat|default:"-" }}</td>
  <td>{% if ride.ascent %}{{ ride.ascent|floatformat }}{% endif %}</td>
</tr>

{% if forloop.last %}
  {% if totals %}<tr class="table-info">
  <th>Totals{% if page_obj.paginator.num_pages > 1 %} (all pages){% endif %}</th>
	<td>{{ totals.count }} rides</td><td></td>
	<td>{{ totals.total_distance|floatformat }}</td>
	<td>{{ totals.total_ascent|floatformat }}</td>
	</tr>{% endif %}
  </table>
{% endif %}

{% empty %}
<p>No rides found :-(</p>
{% endfor %}

{% endblock %}
