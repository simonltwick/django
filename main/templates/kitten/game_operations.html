{% extends 'kitten/base.html' %}

{% block breadcrumbs %}
{% load breadcrumb %}
> {% breadcrumb_url 'Game' 'game' game.id team.id %}
> {% breadcrumb_url 'Operations' 'game_operations' game.id team.id %}
	
{% endblock %}

{% block content %}
<h1>{{ team.name }}: Operations Control Room</h1>
<h2>Line Status on {{ game.current_time|date:"D, g:i a" }}</h2>
{% for line, details in details.items %}
<h4>{{ line.name }}</h4>

<table class="no-border">
<tr><td class="no-border">
{% if details.0 %}  <!-- details.0 are place details -->
<h4>Train status</h4>
<table>
<tr><th>{{ line.direction1 }}</th><th>Location</th>
<th>{{ line.direction2 }}</th></tr>
{% for trains_dir1, location, trains_dir2 in details.0 %}

<tr>

<td>
{% for train in trains_dir1 %}
{{ train.html|safe }}<br>
{% endfor %} <!-- trains -->
</td>

<td>
{{ location.html|safe }}
</td>

<td>
{% for train in trains_dir2 %}
{{ train.html|safe }}<br>
{% endfor %}  <!-- trains 2 -->
</td>

</tr>

{% endfor %}  <!-- line locations -->
</table>

</td><td class="no-border">

<h4>Incident status</h4><small>
{% for incident in details.1 %}  <!-- details.1 is incidents -->

<a href="{% url 'incident' team.id incident.id %}"
	>{{ incident.html|safe }}</a><br>

{% empty %}
No incidents to report.

{% endfor %}
</small></td></tr></table>

<p>{{ line.display_punctuality }}</p>
{% endif %} <!-- places -->

{% empty %}
<p>(No lines for {{ team.name }}.)</p>
{% endfor %}  <!-- lines -->

<a href="{% url 'game_tick' game.id team.id %}">Tick</a>
<a href="{% url 'game_incidents_clear' game.id team.id %}">Clear Incidents</a>

{% if lines_other_op %}

<h2>Other lines:</h2>
<ul>
{% for line in lines_other_op %}
<li>{{ line.name }}
	({{ line.team.name|default_if_none:"<b>No operator</b>>" }})</li>
{% endfor %}
</ul>

{% endif %}

{% endblock %}